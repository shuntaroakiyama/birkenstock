import requests
from bs4 import BeautifulSoup
import smtplib
from email.mime.text import MIMEText
from email.mime.multipart import MIMEMultipart

# âœ… ãƒã‚§ãƒƒã‚¯ã™ã‚‹ãƒšãƒ¼ã‚¸URLï¼ˆãƒŠãƒ­ãƒ¼ã®ã‚µã‚¤ã‚º23cmï¼‰
url = "https://www.birkenstock.com/jp/boston-suede-leather/boston-core-suedeleather-0-evarubber-u_27.html?dwvar_boston-core-suedeleather-0-evarubber-u__27_width=S&dwvar_boston-core-suedeleather-0-evarubber-u__27_size=23&region=JP"

# Gmailã®è¨­å®š
GMAIL_USER = "okasidaisuki0102@gmail.com"
GMAIL_APP_PASSWORD = "qnwg jpir etuo vady"  # 16æ¡ã®ã‚¢ãƒ—ãƒªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰

# âœ… åœ¨åº«ãƒã‚§ãƒƒã‚¯é–¢æ•°ï¼ˆHTMLã‚’è§£æï¼‰
def check_stock():
    response = requests.get(url)
    soup = BeautifulSoup(response.text, "html.parser")

    # âœ… <div class="availability-web"> ã®ä¸­ã‚’å–å¾—
    availability_section = soup.find("div", class_="availability-web")

    # âœ… "åœ¨åº«ã‚ã‚Š" ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å«ã‚€ã‹ç¢ºèª
    if availability_section and availability_section.find("p", class_="in-stock-msg"):
        print("ğŸ‰ å¹…ãƒŠãƒ­ãƒ¼ã®ã‚µã‚¤ã‚º23ãŒå¾©æ´»ï¼ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã‚’é€ä¿¡ã—ã¾ã™ã€‚")
        send_email("ã€åœ¨åº«ã‚ã‚Šã€‘Birkenstock ã‚µã‚¤ã‚º23ï¼ˆå¹…ãƒŠãƒ­ãƒ¼ï¼‰å…¥è·", f"åœ¨åº«ãŒå¾©æ´»ã—ã¾ã—ãŸï¼ä»Šã™ããƒã‚§ãƒƒã‚¯: {url}")
    else:
        print("âŒ åœ¨åº«ãªã—ã€‚")

# âœ… ãƒ¡ãƒ¼ãƒ«é€ä¿¡é–¢æ•°
def send_email(subject, body):
    recipient = GMAIL_USER

    msg = MIMEMultipart()
    msg["From"] = GMAIL_USER
    msg["To"] = recipient
    msg["Subject"] = subject
    msg.attach(MIMEText(body, "plain", "utf-8"))

    with smtplib.SMTP_SSL("smtp.gmail.com", 465) as server:
        server.login(GMAIL_USER, GMAIL_APP_PASSWORD)
        server.sendmail(GMAIL_USER, recipient, msg.as_string())

    print("âœ… ãƒ¡ãƒ¼ãƒ«é€šçŸ¥é€ä¿¡å®Œäº†")

# âœ… ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œ
check_stock()
